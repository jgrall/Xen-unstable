#! /bin/sh

PATH=/etc/xen/scripts:$PATH

case "$XENBUS_TYPE" in
  vbd)
    /etc/xen/scripts/block "$ACTION"
    ;;
  vif)
    [ -n "$script" ] && $script "$ACTION"
    ;;
esac

case "$ACTION" in
  add)
    ;;
  remove)
    # remove device frontend store entries
    xenstore-rm -t $(xenstore-read "$XENBUS_PATH/frontend") || true

    # remove device backend store entries
    xenstore-rm -t "$XENBUS_PATH"       || true
    xenstore-rm -t "error/$XENBUS_PATH" || true
    ;;
  online)
    ;;
  offline)
    ;;
esac
