#! /bin/sh

PATH=/etc/xen/scripts:$PATH

case "$ACTION" in
  add)
    case "$XENBUS_TYPE" in
      vbd)
	/etc/xen/scripts/block bind
        ;;
    esac
    ;;
  remove)
    case "$XENBUS_TYPE" in
      vbd)
	/etc/xen/scripts/block unbind
        ;;
      vif)
        [ -n "$script" ] && $script down
        ;;
    esac
    # remove device backend store entries
    xenstore-rm -t "$XENBUS_PATH"
    xenstore-rm -t "error/$XENBUS_PATH"
    ;;
  online)
    case "$XENBUS_TYPE" in
      vif)
        [ -n "$script" ] && $script up
        ;;
    esac
    ;;
  offline)
    ;;
esac

