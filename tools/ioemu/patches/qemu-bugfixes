Index: ioemu/console.c
===================================================================
--- ioemu.orig/console.c	2006-07-27 11:16:53.732912290 +0100
+++ ioemu/console.c	2006-07-27 11:16:57.753467214 +0100
@@ -449,7 +449,7 @@
             c++;
         }
     }
-    free(s->cells);
+    qemu_free(s->cells);
     s->cells = cells;
 }
 
@@ -954,11 +954,21 @@
     return !active_console->text_console;
 }
 
+void set_color_table(DisplayState *ds) 
+{
+    int i, j;
+    for(j = 0; j < 2; j++) {
+	for(i = 0; i < 8; i++) {
+	    color_table[j][i] =
+		col_expand(ds, vga_get_color(ds, color_table_rgb[j][i]));
+	}
+    }
+}
+
 CharDriverState *text_console_init(DisplayState *ds)
 {
     CharDriverState *chr;
     TextConsole *s;
-    int i,j;
     static int color_inited;
 
     chr = qemu_mallocz(sizeof(CharDriverState));
@@ -976,12 +986,7 @@
 
     if (!color_inited) {
         color_inited = 1;
-        for(j = 0; j < 2; j++) {
-            for(i = 0; i < 8; i++) {
-                color_table[j][i] = col_expand(s->ds, 
-                        vga_get_color(s->ds, color_table_rgb[j][i]));
-            }
-        }
+        set_color_table(ds);
     }
     s->y_displayed = 0;
     s->y_base = 0;
Index: ioemu/usb-linux.c
===================================================================
--- ioemu.orig/usb-linux.c	2006-07-27 11:16:53.732912290 +0100
+++ ioemu/usb-linux.c	2006-07-27 11:16:57.754467103 +0100
@@ -26,6 +26,7 @@
 #if defined(__linux__)
 #include <dirent.h>
 #include <sys/ioctl.h>
+#define __user /* new versions of usbdevice_fs.h use this private attribute */
 #include <linux/usbdevice_fs.h>
 #include <linux/version.h>
 
Index: ioemu/vl.c
===================================================================
--- ioemu.orig/vl.c	2006-07-27 11:16:57.681475183 +0100
+++ ioemu/vl.c	2006-07-27 11:17:33.279534373 +0100
@@ -3201,6 +3201,7 @@
             if (net_tap_fd_init(vlan, fd))
                 ret = 0;
         } else {
+            ifname[0] = '\0';
             get_param_value(ifname, sizeof(ifname), "ifname", p);
             if (get_param_value(setup_script, sizeof(setup_script), "script", p) == 0) {
                 pstrcpy(setup_script, sizeof(setup_script), DEFAULT_NETWORK_SCRIPT);
