Index: ioemu/vl.c
===================================================================
--- ioemu.orig/vl.c	2006-07-27 11:16:57.756466882 +0100
+++ ioemu/vl.c	2006-07-27 11:16:57.828458912 +0100
@@ -4698,7 +4698,7 @@
            "-S              freeze CPU at startup (use 'c' to start execution)\n"
            "-s              wait gdb connection to port %d\n"
            "-p port         change gdb connection port\n"
-           "-d item1,...    output log to %s (use -d ? for a list of log items)\n"
+           "-l item1,...    output log to %s (use -d ? for a list of log items)\n"
            "-hdachs c,h,s[,t]  force hard disk 0 physical geometry and the optional BIOS\n"
            "                translation (t=none or lba) (usually qemu can guess them)\n"
            "-L path         set the directory for the BIOS and VGA BIOS\n"
@@ -4776,7 +4776,7 @@
     QEMU_OPTION_S,
     QEMU_OPTION_s,
     QEMU_OPTION_p,
-    QEMU_OPTION_d,
+    QEMU_OPTION_l,
     QEMU_OPTION_hdachs,
     QEMU_OPTION_L,
 #ifdef USE_CODE_COPY
@@ -4845,7 +4845,7 @@
     { "S", 0, QEMU_OPTION_S },
     { "s", 0, QEMU_OPTION_s },
     { "p", HAS_ARG, QEMU_OPTION_p },
-    { "d", HAS_ARG, QEMU_OPTION_d },
+    { "l", HAS_ARG, QEMU_OPTION_l },
     { "hdachs", HAS_ARG, QEMU_OPTION_hdachs },
     { "L", HAS_ARG, QEMU_OPTION_L },
 #ifdef USE_CODE_COPY
@@ -5096,6 +5096,8 @@
     char usb_devices[MAX_VM_USB_PORTS][128];
     int usb_devices_index;
 
+    char qemu_dm_logfilename[64];
+
     LIST_INIT (&vm_change_state_head);
 #if !defined(CONFIG_SOFTMMU)
     /* we never want that malloc() uses mmap() */
@@ -5145,6 +5147,11 @@
     nb_nics = 0;
     /* default mac address of the first network interface */
     
+    /* init debug */
+    sprintf(qemu_dm_logfilename, "/var/log/qemu-dm.%d.log", getpid());
+    cpu_set_log_filename(qemu_dm_logfilename);
+    cpu_set_log(0);
+    
     optind = 1;
     for(;;) {
         if (optind >= argc)
@@ -5330,7 +5337,7 @@
                     exit(1);
                 }
                 break;
-            case QEMU_OPTION_d:
+            case QEMU_OPTION_l:
                 {
                     int mask;
                     CPULogItem *item;
@@ -5701,7 +5708,7 @@
         stk.ss_flags = 0;
 
         if (sigaltstack(&stk, NULL) < 0) {
-            perror("sigaltstack");
+            fprintf(logfile, "sigaltstack returned error %d\n", errno);
             exit(1);
         }
     }
