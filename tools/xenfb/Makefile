XEN_ROOT=../..
include $(XEN_ROOT)/tools/Rules.mk

CFLAGS += -I$(XEN_LIBXC) -I$(XEN_XENSTORE) -I$(XEN_ROOT)/linux-2.6-xen-sparse/include
LDFLAGS += -L$(XEN_LIBXC) -L$(XEN_XENSTORE)

INSTALL         = install
INSTALL_PROG    = $(INSTALL) -m0755
INSTALL_DIR     = $(INSTALL) -d -m0755

.PHONY: all
all: build

.PHONY: build
build: mk-symlinks
	$(MAKE) vncfb sdlfb

install: all
	$(INSTALL_DIR) -p $(DESTDIR)/usr/$(LIBDIR)/xen/bin
	$(INSTALL_PROG) vncfb $(DESTDIR)/usr/$(LIBDIR)/xen/bin/xen-vncfb
	$(INSTALL_PROG) sdlfb $(DESTDIR)/usr/$(LIBDIR)/xen/bin/xen-sdlfb

sdlfb: sdlfb.o xenfb.o

sdlfb.o: CFLAGS += $(shell sdl-config --cflags)
sdlfb: LDLIBS += $(shell sdl-config --libs) -lxenctrl -lxenstore

clean:
	$(RM) *.o *~ vncfb sdlfb

vncfb: vncfb.o xenfb.o
vncfb.o: CFLAGS += $(shell libvncserver-config --cflags)
vncfb: LDLIBS += $(shell libvncserver-config --libs) -lxenctrl -lxenstore

sdlfb.o xenfb.o vncfb.o: xenfb.h
