# Test that read only connection can't alter store.

write /test contents

readonly
expect test
expect tool
dir /

expect contents
read /test
expect 0 READ
getperm /test
watch /test token
unwatch /test token 
start
commit
start
abort

# These don't work
expect write failed: Permission denied
write /test2 contents
expect write failed: Permission denied
write /test contents
expect setperm failed: Permission denied
setperm /test 100 NONE
expect setperm failed: Permission denied
setperm /test 100 NONE
expect introduce failed: Permission denied
introduce 1 100 7 /home

# Check that watches work like normal.
watch / token
1 readwrite
1 write /test contents
expect /test:token
waitwatch
