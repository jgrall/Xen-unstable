# Test watching from a domain.

# Watch something, write to it, check watch has fired.
write /test contents
mkdir /dir

expect handle is 1
introduce 1 100 7 /my/home
1 watch /test token
write /test contents2
expect 1:/test:token
1 waitwatch
1 unwatch /test token
release 1
1 close

# ignore watches while doing commands, should work.
expect handle is 1
introduce 1 100 7 /my/home
1 watch /dir token
write /dir/test contents
1 write /dir/test2 contents2
1 write /dir/test3 contents3
1 write /dir/test4 contents4
expect 1:/dir/test:token
1 waitwatch
release 1
1 close

# unwatch
expect handle is 1
introduce 1 100 7 /my/home
1 watch /dir token1
1 unwatch /dir token1
1 watch /dir token2
write /dir/test2 contents
expect 1:/dir/test2:token2
1 waitwatch
1 unwatch /dir token2
release 1
1 close

# unwatch while watch pending.
expect handle is 1
introduce 1 100 7 /my/home
1 watch /dir token1
write /dir/test2 contents
1 unwatch /dir token1
release 1
1 close
