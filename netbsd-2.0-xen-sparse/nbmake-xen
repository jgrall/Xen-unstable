#! /bin/sh
# Set proper variables to allow easy "make" building of a NetBSD subtree.
# Generated from:  $NetBSD: build.sh,v 1.126 2004/02/04 11:23:40 lukem Exp $
#

: ${HOS:=$(uname -s | tr /A-Z/ /a-z/)}
: ${HARCH:=$(uname -m 2>/dev/null || echo i386)}
: ${NETBSD_RELEASE:=$(basename $(cd $(dirname $0) && pwd) | sed 's/netbsd-\([0-9]\+\.[0-9]\+\).*/\1/')}
: ${NETBSD_VERSION:=$(basename $(cd $(dirname $0) && pwd) | sed 's/netbsd-\([0-9]\+\.[0-9]\+.*\)-xen.*/\1/')}
: ${TOPDIR:=$(cd $(dirname $0) && pwd | sed 's/\(netbsd-[0-9]\+\.[0-9]\+.*-xen[^/]*\)/\1/')}

case "$HARCH" in
i586|i686)
  HARCH=i386
  ;;
esac

NETBSDSRCDIR="$TOPDIR"; export NETBSDSRCDIR
DESTDIR="$TOPDIR/root"; export DESTDIR
unset MAKEOBJDIRPREFIX
MAKEOBJDIR='${.CURDIR:C,^'"$TOPDIR,$TOPDIR/obj,}"; export MAKEOBJDIR
RELEASEDIR="$TOPDIR/release"; export RELEASEDIR
MKUNPRIVED='yes'; export MKUNPRIVED
MAKEVERBOSE='1'; export MAKEVERBOSE
LC_ALL='C'; export LC_ALL
TOOLDIR="$TOPDIR/../netbsd-${NETBSD_RELEASE}-tools/$HOS-$HARCH"; export TOOLDIR
MACHINE='i386'; export MACHINE
MACHINE_ARCH='i386'; export MACHINE_ARCH
MAKEFLAGS="-de -m $TOPDIR/share/mk MKOBJDIRS=yes"; export MAKEFLAGS
BUILDID="${NETBSD_RELEASE}"; export BUILDID
USETOOLS=yes; export USETOOLS

exec "${TOOLDIR}/bin/nbmake" ${1+"$@"}
